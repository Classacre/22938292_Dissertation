# Arabidopsis Root scRNA-seq Analysis: Directory Structure, Objectives, and Workflow

## Publication and Data Availability

This repository contains the code, scripts, and documentation for the analysis performed in Mika Nieuwenhuyzen's Bioinformatics dissertation (Student number: 22938292), supervised by James Lloyd at the University of Western Australia.

**Note:**
- The primary Seurat object used for these analyses (`Oliva_dataset/integrated_col_trajectories.rds`) is not included in this repository, as it is not yet published or publicly available. Users will not be able to reproduce the full analysis or generate the same results until this dataset is released.
- The GBM gene list (`gbM_data/unique_gbm_genes.csv`) is also not included in this repository, as it is the property of Cahn et al ([PubMed](https://pubmed.ncbi.nlm.nih.gov/39632087/)) and Bewick et al ([PNAS](https://www.pnas.org/doi/10.1073/pnas.1604666113)). You must obtain permission or access to these data from the original sources.

All code and workflow steps are provided for transparency and future reproducibility.

---

## Project Objectives & Hypothesis

### Specific Objectives
1. **Identify high- and low-noise genes:**
   - Calculate coefficient of variation (CV) for each gene across cells.
   - Classify top 10% as "high-noise genes" and bottom 10% as "low-noise genes".
2. **Identify responsive genes:**
   - Find genes induced in one cell type but not another.
   - Characterize noise level of responsive genes.
3. **Genomic feature analysis:**
   - Identify features (e.g., DNA methylation status) of high/low noise and high/low responsiveness genes.
   - Determine shared features between noisy and responsive genes.

### Research Hypothesis
- Genes with gbM (gene body methylation) will exhibit less noisy expression within the same cell type compared to unmethylated genes.
- Responsive (cell-type-specific) genes are less likely to exhibit gbM compared to housekeeping genes.

---

## Directory Structure & Purpose

- `gbm_noise_analysis/`  
  Main pipeline scripts (R and bash), logs, and results for noise and methylation analysis.
- `seurat_utilities/`  
  Batch scripts for Seurat summary and visualization.
- `seurat_metadata/`  
  Seurat metadata sample files and metadata summary scripts.
- `seurat_plots/`  
  All PNG plots generated by Seurat visualization scripts.
- `misc_files/`  
  Documentation, notes, and uncategorized scripts (e.g., `seurat_metadata/seurat_metadata_summary.R`, `Seurat_Visualization.R`, `selfdoc.txt`).

---

## Workflow Steps

### 1. Export Expression Matrix
- Run: `sbatch gbm_noise_analysis/export_expression_matrix.sh`
- Output: `gbm_noise_analysis/expression_matrix.csv`

### 2. Calculate Expression Noise & Compare gbM
- Run: `sbatch gbm_noise_analysis/gbm_noise_analysis.sh`
- Output: `gbm_noise_analysis/gbm_noise_comparison.csv`, `gbm_noise_analysis/gbm_noise_boxplot.png`, `gbm_noise_analysis/gbm_noise_stats.txt`

### 3. Check Genotype Diversity
- Run: `sbatch gbm_noise_analysis/check_genotypes.sh`
- Output: `gbm_noise_analysis/genotype_counts.csv`

### 4. (Optional) Seurat Object Summary & Metadata Sample
- Move `misc_files/seurat_metadata/seurat_metadata_summary.R` to `seurat_metadata/seurat_metadata_summary.R`.
- Run: `sbatch seurat_utilities/run_seurat_summary.sh`
- Output: `seurat_metadata/seurat_metadata_sample.csv`, `seurat_metadata/seurat_summary.txt`

### 5. (Optional) Seurat Visualization
- Move `misc_files/Seurat_Visualization.R` to `seurat_utilities/Seurat_Visualization.R`.
- Run: `sbatch seurat_utilities/run_seurat_viz.sh`
- Output: PNG plots in `seurat_plots/`

---

## Environment Setup and Running Scripts

### 1. Conda Environment Setup

Load Anaconda and create the environment (run once):
```sh
module load Anaconda3/2024.06
conda create -p /group/sms029/conda_environment/R -c conda-forge r-base=4.3.1
conda init
source ~/.bashrc
conda activate /group/sms029/conda_environment/R
conda install -c conda-forge r-seurat
```

If you need to make R or Python binaries executable:
```sh
chmod u+x /group/sms029/conda_environment/R/bin/R
chmod -R u+x /group/sms029/conda_environment/R/bin/
chmod -R u+x /group/sms029/conda_environment/R/lib/R/bin/
chmod -R u+x /group/sms029/conda_environment/R/bin/python
```

### 2. Running Scripts

**Recommended:** Use `sbatch` to submit jobs (see workflow steps above).

**For interactive work:**
```sh
srun -p work --pty --mem=16G -c 4 bash
# or for a lighter session:
srun -p work --pty --mem=8G -c 2 bash
```

Then, in R:
```R
source("seurat_metadata/seurat_metadata_summary.R")
source("seurat_utilities/Seurat_Visualization.R")
```

---

## Notes
- All logs for the main pipeline are in `gbm_noise_analysis/logs/`.
- All logs for Seurat summary/viz are in `seurat_utilities/`.
- Review and further categorize files in `misc_files/` as needed.
- Update any script paths if you move scripts as described above.
